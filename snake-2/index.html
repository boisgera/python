<!DOCTYPE html><html lang="fr" data-astro-cid-vc27etzb> <head><title>The Great Refactoring</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v3.6.5"><style>aside[data-astro-cid-fjubpvhp]{border:.125rem solid var(--dark);border-radius:.25rem;margin-bottom:1rem}summary[data-astro-cid-fjubpvhp]{padding:1rem;border-top-left-radius:.25rem;border-top-right-radius:.25rem;background-color:var(--light)}details[data-astro-cid-fjubpvhp]>summary[data-astro-cid-fjubpvhp]{list-style:none;border-radius:.25rem;border-bottom-left-radius:0;border-bottom-right-radius:0}.minmax[data-astro-cid-fjubpvhp]{color:var(--dark)}details[data-astro-cid-fjubpvhp].lock{pointer-events:none}details[data-astro-cid-fjubpvhp].lock .minmax[data-astro-cid-fjubpvhp]{display:none}details[data-astro-cid-fjubpvhp][open] .open[data-astro-cid-fjubpvhp]{display:inline}details[data-astro-cid-fjubpvhp][open] .closed[data-astro-cid-fjubpvhp]{display:none}details[data-astro-cid-fjubpvhp]:not([open]) .open[data-astro-cid-fjubpvhp]{display:none}details[data-astro-cid-fjubpvhp]:not([open]) .closed[data-astro-cid-fjubpvhp]{display:inline}.content[data-astro-cid-fjubpvhp]{border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}svg[data-astro-cid-fjubpvhp]{height:1rem}.circle[data-astro-cid-fjubpvhp]{height:1.25rem;width:1.25rem;border-radius:.25rem;background-color:var(--dark);color:#fff;display:flex;justify-content:center;align-items:center}
</style>
<link rel="stylesheet" href="/python/_astro/burger.acc87366.css" /><script type="module">document.startViewTransition&&document.querySelectorAll("details").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),document.startViewTransition(()=>t.toggleAttribute("open"))})});
</script></head> <body data-astro-cid-vc27etzb> <nav data-astro-cid-vc27etzb> <a href="/python" data-astro-cid-vc27etzb><svg viewBox="0 0 128 128" style="width:2rem;height:2rem;" data-astro-cid-vc27etzb astro-icon="python"><linearGradient id="astroicon:pythona" x1="70.252" x2="170.659" y1="1237.476" y2="1151.089" gradientTransform="matrix(.563 0 0 -.568 -29.215 707.817)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#5A9FD4"/><stop offset="1" stop-color="#306998"/></linearGradient><linearGradient id="astroicon:pythonb" x1="209.474" x2="173.62" y1="1098.811" y2="1149.537" gradientTransform="matrix(.563 0 0 -.568 -29.215 707.817)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#FFD43B"/><stop offset="1" stop-color="#FFE873"/></linearGradient><path fill="url(#astroicon:pythona)" d="M63.391 1.988c-4.222.02-8.252.379-11.8 1.007-10.45 1.846-12.346 5.71-12.346 12.837v9.411h24.693v3.137H29.977c-7.176 0-13.46 4.313-15.426 12.521-2.268 9.405-2.368 15.275 0 25.096 1.755 7.311 5.947 12.519 13.124 12.519h8.491V67.234c0-8.151 7.051-15.34 15.426-15.34h24.665c6.866 0 12.346-5.654 12.346-12.548V15.833c0-6.693-5.646-11.72-12.346-12.837-4.244-.706-8.645-1.027-12.866-1.008zM50.037 9.557c2.55 0 4.634 2.117 4.634 4.721 0 2.593-2.083 4.69-4.634 4.69-2.56 0-4.633-2.097-4.633-4.69-.001-2.604 2.073-4.721 4.633-4.721z" transform="translate(0 10.26)"/><path fill="url(#astroicon:pythonb)" d="M91.682 28.38v10.966c0 8.5-7.208 15.655-15.426 15.655H51.591c-6.756 0-12.346 5.783-12.346 12.549v23.515c0 6.691 5.818 10.628 12.346 12.547 7.816 2.297 15.312 2.713 24.665 0 6.216-1.801 12.346-5.423 12.346-12.547v-9.412H63.938v-3.138h37.012c7.176 0 9.852-5.005 12.348-12.519 2.578-7.735 2.467-15.174 0-25.096-1.774-7.145-5.161-12.521-12.348-12.521h-9.268zM77.809 87.927c2.561 0 4.634 2.097 4.634 4.692 0 2.602-2.074 4.719-4.634 4.719-2.55 0-4.633-2.117-4.633-4.719 0-2.595 2.083-4.692 4.633-4.692z" transform="translate(0 10.26)"/><radialGradient id="astroicon:pythonc" cx="1825.678" cy="444.45" r="26.743" gradientTransform="matrix(0 -.24 -1.055 0 532.979 557.576)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#B8B8B8" stop-opacity=".498"/><stop offset="1" stop-color="#7F7F7F" stop-opacity="0"/></radialGradient><path fill="url(#astroicon:pythonc)" d="M97.309 119.597c0 3.543-14.816 6.416-33.091 6.416-18.276 0-33.092-2.873-33.092-6.416 0-3.544 14.815-6.417 33.092-6.417 18.275 0 33.091 2.872 33.091 6.417z" opacity=".444"/></svg></a> </nav> <main data-astro-cid-vc27etzb> <header style="margin-bottom: 3rem;"> <div style="margin-bottom: 1.5rem;"> <h1 style="font-size: 2.25rem; line-height:1; font-weight:700; color: #020617;
    margin-bottom: 1rem;"> The Great Refactoring </h1> <p style="color: #64748b;"> Time to clean up our code before it gets out of hand! </p> </div> <div style="display: flex; justify-content: left; gap: 1rem;"> <img src="https://2.gravatar.com/avatar/39ec5d637b0753448b97a8e63855a45cb6708d033b656fe9f1d3314bb4bfb202?size=128" alt="avatar" style="margin: 0px; flex: 0 48px; width: 48px; height: 48px; border-radius: 50%;"> <p style="margin: 0px; flex: auto; font-size: 0.875rem; line-height: 1.25rem; color: #1e293b;"> Sébastien Boisgérault <br> Associate Professor, ITN Mines Paris – PSL </p><p></p>  </div> </header>

<img src="/python/_astro/blacksmith.149d0d49_Z27r9Ur.webp" transition:name="blacksmith" alt="Blacksmith" style="border-radius: 0.375rem; width: 100%; height: auto; height: auto;" width="4997" height="3336" loading="lazy" decoding="async">
<blockquote>
<p>Make it work, then make it beautiful, then if you really, really have to,
make it fast. 90 percent of the time, if you make it beautiful,
it will already be fast. So really, just make it beautiful!</p>
<p>Joe Armstrong, designer of the Erlang programming language</p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p>In this tutorial, we will continue to develop our snake game.</p>
<p>We will add almost no new feature in this session ; instead,
we will do some <strong>refactoring</strong>, i.e., restructure our existing code
using some “best practices” that will (hopefully!) make it easier to
maintain and extend.</p>
<p>Here is a reminder of the current project state:</p>
<aside data-astro-cid-fjubpvhp style="--light: #e0f2fe;--dark: #164e63;"> <details class="" data-astro-cid-fjubpvhp style="--light: #e0f2fe;--dark: #164e63;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #e0f2fe;--dark: #164e63;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #e0f2fe;--dark: #164e63;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #e0f2fe;--dark: #164e63;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:pencil"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M4 20h4L18.5 9.5a1.5 1.5 0 0 0-4-4L4 16v4M13.5 6.5l4 4"/></g></svg> </span> <span style="font-weight:500;; --light: #e0f2fe;--dark: #164e63;" data-astro-cid-fjubpvhp>The code so far</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #e0f2fe;--dark: #164e63;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #e0f2fe;--dark: #164e63;"> <div style="margin: 1rem;; --light: #e0f2fe;--dark: #164e63;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.init(</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">fps</span><span style="color:#F97583">=</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">snake_direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">rocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 11</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            rocks.append([i, j])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_fruit</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> fruit</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fruit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">29</span><span style="color:#E1E4E8">), pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">29</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">spawn_new_fruit()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">arrow_keys </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, snake_direction</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> pyxel.btnp(pyxel.</span><span style="color:#79B8FF">KEY_Q</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.quit()</span></span>
<span class="line"><span style="color:#E1E4E8">    arrow_keys_pressed </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> arrow_keys:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> pyxel.btnp(key):</span></span>
<span class="line"><span style="color:#E1E4E8">            arrow_keys_pressed.append(key)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> arrow_keys_pressed:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 29</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 29</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    ):</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.cls(</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(fruit[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], fruit[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.run(update, draw)</span></span></code></pre> </div> </div> </details> </aside>   
<h2 id="no-more-magic">No More Magic</h2>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Geometry</span></span>
<span class="line"><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 30</span></span>
<span class="line"><span style="color:#79B8FF">HEIGHT</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Frame rate</span></span>
<span class="line"><span style="color:#79B8FF">FPS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Colors</span></span>
<span class="line"><span style="color:#79B8FF">BLACK</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#79B8FF">WHITE</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 7</span></span>
<span class="line"><span style="color:#79B8FF">PINK</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 8</span></span>
<span class="line"><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Directions</span></span>
<span class="line"><span style="color:#79B8FF">UP</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">RIGHT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">DOWN</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">LEFT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">ARROW_KEYS</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.init(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">fps</span><span style="color:#F97583">=</span><span style="color:#79B8FF">FPS</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">rocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 11</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            rocks.append([i, j])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_fruit</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> fruit</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fruit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">spawn_new_fruit()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, snake_direction</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> pyxel.btnp(pyxel.</span><span style="color:#79B8FF">KEY_Q</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.quit()</span></span>
<span class="line"><span style="color:#E1E4E8">    arrow_keys_pressed </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> ARROW_KEYS</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> pyxel.btnp(key):</span></span>
<span class="line"><span style="color:#E1E4E8">            arrow_keys_pressed.append(key)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> arrow_keys_pressed:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> UP</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DOWN</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> LEFT</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    ):</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.cls(</span><span style="color:#79B8FF">WHITE</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(fruit[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], fruit[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">PINK</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">BLACK</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.run(update, draw)</span></span></code></pre> </div> </div> </details> </aside>   
<h2 id="modules">Modules</h2>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <p><code>constants.py</code>:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Geometry</span></span>
<span class="line"><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 30</span></span>
<span class="line"><span style="color:#79B8FF">HEIGHT</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Frame rate</span></span>
<span class="line"><span style="color:#79B8FF">FPS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Colors</span></span>
<span class="line"><span style="color:#79B8FF">BLACK</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#79B8FF">WHITE</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 7</span></span>
<span class="line"><span style="color:#79B8FF">PINK</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 8</span></span>
<span class="line"><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Directions</span></span>
<span class="line"><span style="color:#79B8FF">UP</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">RIGHT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">DOWN</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">LEFT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">ARROW_KEYS</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span></code></pre><p><code>snake.py</code>:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> constants </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.init(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">fps</span><span style="color:#F97583">=</span><span style="color:#79B8FF">FPS</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">rocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 11</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            rocks.append([i, j])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_fruit</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> fruit</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fruit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">spawn_new_fruit()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, snake_direction</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> pyxel.btnp(pyxel.</span><span style="color:#79B8FF">KEY_Q</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.quit()</span></span>
<span class="line"><span style="color:#E1E4E8">    arrow_keys_pressed </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> ARROW_KEYS</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> pyxel.btnp(key):</span></span>
<span class="line"><span style="color:#E1E4E8">            arrow_keys_pressed.append(key)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> arrow_keys_pressed:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> UP</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DOWN</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> LEFT</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    ):</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.cls(</span><span style="color:#79B8FF">WHITE</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(fruit[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], fruit[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">PINK</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">BLACK</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.run(update, draw)</span></span></code></pre> </div> </div> </details> </aside>   
<h2 id="fine-grained-functions">Fine-Grained Functions</h2>
<ul>
<li>
<p>Introduce <code>spawn_new_rocks</code> and <code>spawn_new_snake</code> functions
(similar to <code>spawn_new_fruit</code>) and then a <code>spawn_everything</code> function.</p>
</li>
<li>
<p>Split the large <code>update</code> function into <code>handle_events</code> and <code>snake_move</code>
functions.</p>
</li>
</ul>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> constants </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_rocks</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#E1E4E8">    rocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 11</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                rocks.append([i, j])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_snake</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_fruit</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> fruit</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fruit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_everything</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    spawn_new_rocks()</span></span>
<span class="line"><span style="color:#E1E4E8">    spawn_new_snake()</span></span>
<span class="line"><span style="color:#E1E4E8">    spawn_new_fruit()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> handle_events</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> pyxel.btnp(pyxel.</span><span style="color:#79B8FF">KEY_Q</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.quit()</span></span>
<span class="line"><span style="color:#E1E4E8">    arrow_keys_pressed </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> ARROW_KEYS</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> pyxel.btnp(key):</span></span>
<span class="line"><span style="color:#E1E4E8">            arrow_keys_pressed.append(key)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> arrow_keys_pressed:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> UP</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DOWN</span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> LEFT</span><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#F97583">        elif</span><span style="color:#E1E4E8"> key </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> snake_move</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, fruit</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> new_snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    ):</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    handle_events()</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_move()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.cls(</span><span style="color:#79B8FF">WHITE</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_body </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_body:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, </span><span style="color:#79B8FF">BLACK</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.pset(fruit[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], fruit[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">PINK</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.init(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">fps</span><span style="color:#F97583">=</span><span style="color:#79B8FF">FPS</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">spawn_everything()</span></span>
<span class="line"><span style="color:#E1E4E8">pyxel.run(update, draw)</span></span></code></pre> </div> </div> </details> </aside>   
<h2 id="draw-refactoring">Draw Refactoring</h2>
<p>Implement a function <code>display</code> that draws list of colored pixels.
Make sure that it works in a way that we can replace the original
implementation of <code>draw</code> with:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    pyxel.cls(</span><span style="color:#79B8FF">WHITE</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_body </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#E1E4E8">, snake_body)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#E1E4E8">, [snake_head])</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">BLACK</span><span style="color:#E1E4E8">, rocks)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">PINK</span><span style="color:#E1E4E8">, [fruit])</span></span></code></pre>
<p>Then extend the <code>display</code> function so that:</p>
<ul>
<li>
<p>when its second argument is not specified, it should apply the color
to all pixels of the screen;</p>
</li>
<li>
<p>when the second argument is a single pixel and not a list of pixels,
it should apply the color to this pixel.</p>
</li>
</ul>
<p>Simplify the implementation of <code>draw</code> to leverage these extensions</p>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <p>The first version of <code>draw</code> can be written:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> display</span><span style="color:#E1E4E8">(color, pixels):</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> pixels:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.pset(x, y, color)</span></span></code></pre><p>Its extension can be written:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> display</span><span style="color:#E1E4E8">(color, pixels</span><span style="color:#F97583">=</span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> pixels </span><span style="color:#F97583">is</span><span style="color:#79B8FF"> None</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.cls(color)</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(pixels) </span><span style="color:#F97583">&gt;=</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583"> and</span><span style="color:#79B8FF"> type</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">list</span><span style="color:#E1E4E8">(pixels)[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> int</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        display(color, [pixels])</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> pixels:</span></span>
<span class="line"><span style="color:#E1E4E8">            pyxel.pset(x, y, color)</span></span></code></pre><p>After this second change, we can rewrite <code>draw</code> as:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">WHITE</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_body </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#E1E4E8">, snake_body)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#E1E4E8">, snake_head)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">BLACK</span><span style="color:#E1E4E8">, rocks)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">PINK</span><span style="color:#E1E4E8">, fruit)</span></span></code></pre> </div> </div> </details> </aside>   
<h2 id="move-snake">Move Snake</h2>
<p>Introduce a <code>crash</code> function such that <code>snake_move</code> may be replaced with the code:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> snake_move</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, fruit</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> crash(new_snake_head):</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span></code></pre>
<p>Document the role of this function using an appropriate docstring.</p>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> crash</span><span style="color:#E1E4E8">(head):</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    Returns True if the snake crashes: </span></span>
<span class="line"><span style="color:#9ECBFF">      - into itself, </span></span>
<span class="line"><span style="color:#9ECBFF">      - into a rock, </span></span>
<span class="line"><span style="color:#9ECBFF">      - or into the arena wall.</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span></code></pre> </div> </div> </details> </aside>   
<p>Introduce a few comments into the <code>snake_move</code> function to explain
the parts that may still be a bit cryptic (I am thinking about the
evolution of the snake geometry). I’d like the game logic to be as
explicit as possible here!</p>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> snake_move</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, fruit</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> crash(new_snake_head): </span><span style="color:#6A737D"># 💀</span></span>
<span class="line"><span style="color:#6A737D">        # 🐍 keep the old head and shrink the tail</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit: </span><span style="color:#6A737D"># 🍓</span></span>
<span class="line"><span style="color:#6A737D">        # 🐍 move the head and grow the tail</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">        # 🐍 move the head; the tail follows</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span></code></pre> </div> </div> </details> </aside>   
<h2 id="generic-event-handling">Generic Event Handling</h2>
<p>Our current event <code>handle_events</code> code is not completely satisfying: if we
need to manage more events, for example if we want to add a pause feature,
we need to modify and grow the function.</p>
<p>To prevent this, we replace it with a generic event handling system,
in which we never change the <code>handle_events</code> function when we introduce
new events. The core of this system is described in the following
<code>events.py</code> file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">_handlers </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> register</span><span style="color:#E1E4E8">(event, handler):</span></span>
<span class="line"><span style="color:#E1E4E8">    _handlers.append([event, handler])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> handle</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> event, handler </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> _handlers:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> pyxel.btnp(event):</span></span>
<span class="line"><span style="color:#E1E4E8">            handler()</span></span></code></pre>
<p>This new module should be imported into our main Python file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> events</span></span></code></pre>
<p>and the update function modified as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    events.handle()</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_move()</span></span></code></pre>
<p>You can now delete the code of the <code>handle_events</code> function!</p>
<p>Initially, this <code>events.handle</code> function does nothing, but now we can
easily register any action (implemented as as function) that we want to associate with an event.
For example, to quit the game when the <code>Q</code> key is pressed, we can write:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_Q</span><span style="color:#E1E4E8">, pyxel.quit)</span></span></code></pre>
<p>Use this new system to handle the arrows key press: define appropriate
<code>move_up</code>, <code>move_right</code>, <code>move_down</code>, and <code>move_left</code> actions, and
register them with the appropriate events.</p>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_up</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> UP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_right</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_down</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DOWN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_left</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> LEFT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">, move_up)</span></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span><span style="color:#E1E4E8">, move_right)</span></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">, move_down)</span></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">, move_left)</span></span></code></pre> </div> </div> </details> </aside>   
<p>Use this new system to pause/unpause the game when the <code>P</code> key is pressed
(you will need to slightly modify the <code>snake_move</code> function).</p>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">paused </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> pause</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> paused</span></span>
<span class="line"><span style="color:#E1E4E8">    paused </span><span style="color:#F97583">=</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> paused</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_P</span><span style="color:#E1E4E8">, pause)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> snake_move</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, fruit</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> paused:</span></span>
<span class="line"><span style="color:#F97583">        return</span></span>
<span class="line"><span style="color:#79B8FF">    ...</span></span>
<span class="line"></span></code></pre> </div> </div> </details> </aside>   
<h2 id="synthesis">Synthesis</h2>
<p>Here is the final result of our refactoring:</p>
<aside data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <details class="" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <summary style="display:flex;align-items:center;justify-content:space-between;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span style="display:flex;gap:0.5em;align-items:center;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <span class="circle" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp astro-icon="tabler:bulb"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 12h1m8-9v1m8 8h1M5.6 5.6l.7.7m12.1-.7-.7.7M9 16a5 5 0 1 1 6 0 3.5 3.5 0 0 0-1 3 2 2 0 0 1-4 0 3.5 3.5 0 0 0-1-3M9.7 17h4.6"/></g></svg> </span> <span style="font-weight:500;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp>Solution</span> </span> <span class="minmax" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="closed" astro-icon="tabler:arrows-maximize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M16 4h4v4M14 10l6-6M8 20H4v-4M4 20l6-6M16 20h4v-4M14 14l6 6M8 4H4v4M4 4l6 6"/></g></svg> <svg viewBox="0 0 24 24" data-astro-cid-fjubpvhp class="open" astro-icon="tabler:arrows-minimize"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M5 9h4V5M3 3l6 6M5 15h4v4M3 21l6-6M19 9h-4V5M15 9l6-6M19 15h-4v4M15 15l6 6"/></g></svg> </span> </summary> <div class="content" data-astro-cid-fjubpvhp style="--light: #fbcfe8;--dark: #db2777;"> <div style="margin: 1rem;; --light: #fbcfe8;--dark: #db2777;" data-astro-cid-fjubpvhp> <p><code>constants.py</code>:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Screen Size</span></span>
<span class="line"><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> HEIGHT</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Frame Rate</span></span>
<span class="line"><span style="color:#79B8FF">FPS</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Colors</span></span>
<span class="line"><span style="color:#79B8FF">BLACK</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#79B8FF">WHITE</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 7</span></span>
<span class="line"><span style="color:#79B8FF">RED</span><span style="color:#F97583"> =</span><span style="color:#79B8FF">  8</span></span>
<span class="line"><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Geometry</span></span>
<span class="line"><span style="color:#79B8FF">UP</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">RIGHT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">DOWN</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">LEFT</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span></code></pre><p><code>events.py</code>:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">_handlers </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> register</span><span style="color:#E1E4E8">(event, handler):</span></span>
<span class="line"><span style="color:#E1E4E8">    _handlers.append([event, handler])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> handle</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> event, handler </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> _handlers:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> pyxel.btnp(event):</span></span>
<span class="line"><span style="color:#E1E4E8">            handler()</span></span></code></pre><p><code>snake.py</code>:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pyxel</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> constants </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> events</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_rocks</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#E1E4E8">    rocks </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> (i</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">j) </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 11</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                rocks.append([i, j])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_snake</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        [</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_new_fruit</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> fruit</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fruit </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">            pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), </span></span>
<span class="line"><span style="color:#E1E4E8">            pyxel.rndi(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> fruit </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> rocks:</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> spawn_everything</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    spawn_new_rocks()</span></span>
<span class="line"><span style="color:#E1E4E8">    spawn_new_snake()</span></span>
<span class="line"><span style="color:#E1E4E8">    spawn_new_fruit()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_Q</span><span style="color:#E1E4E8">, pyxel.quit)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_up</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> UP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_right</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> RIGHT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_down</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> DOWN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> move_left</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_direction</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_direction </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> LEFT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_UP</span><span style="color:#E1E4E8">, move_up)</span></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_RIGHT</span><span style="color:#E1E4E8">, move_right)</span></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_DOWN</span><span style="color:#E1E4E8">, move_down)</span></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_LEFT</span><span style="color:#E1E4E8">, move_left)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">paused </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> pause</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> paused</span></span>
<span class="line"><span style="color:#E1E4E8">    paused </span><span style="color:#F97583">=</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> paused</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">events.register(pyxel.</span><span style="color:#79B8FF">KEY_P</span><span style="color:#E1E4E8">, pause)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> crash</span><span style="color:#E1E4E8">(head):</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    Returns True if the snake crashes: </span></span>
<span class="line"><span style="color:#9ECBFF">      - into itself, </span></span>
<span class="line"><span style="color:#9ECBFF">      - into a rock, </span></span>
<span class="line"><span style="color:#9ECBFF">      - or into the arena wall.</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> snake_geometry</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> rocks</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> WIDTH</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        or</span><span style="color:#E1E4E8"> head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> HEIGHT</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> snake_move</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">    global</span><span style="color:#E1E4E8"> snake_geometry, fruit</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> paused:</span></span>
<span class="line"><span style="color:#F97583">        return</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    new_snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_head[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> snake_direction[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> crash(new_snake_head): </span><span style="color:#6A737D"># 💀</span></span>
<span class="line"><span style="color:#6A737D">        # 🐍 keep the old head and shrink the tail</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [snake_head]</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#E1E4E8"> new_snake_head </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> fruit: </span><span style="color:#6A737D"># 🍓</span></span>
<span class="line"><span style="color:#6A737D">        # 🐍 move the head and grow the tail</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"><span style="color:#E1E4E8">        spawn_new_fruit()</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">        # 🐍 move the head; the tail follows</span></span>
<span class="line"><span style="color:#E1E4E8">        snake_geometry </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> [new_snake_head]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    events.handle()</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_move()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> display</span><span style="color:#E1E4E8">(color, pixels</span><span style="color:#F97583">=</span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> pixels </span><span style="color:#F97583">is</span><span style="color:#79B8FF"> None</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        pyxel.cls(color)</span></span>
<span class="line"><span style="color:#F97583">    elif</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(pixels) </span><span style="color:#F97583">&gt;=</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583"> and</span><span style="color:#79B8FF"> isinstance</span><span style="color:#E1E4E8">(pixels[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        display(color, [pixels])</span></span>
<span class="line"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> x, y </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> pixels:</span></span>
<span class="line"><span style="color:#E1E4E8">            pyxel.pset(x, y, color)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> draw</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">WHITE</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_body </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    snake_head </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> snake_geometry[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">DARK_GREEN</span><span style="color:#E1E4E8">, snake_body)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">LIGHT_GREEN</span><span style="color:#E1E4E8">, snake_head)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">BLACK</span><span style="color:#E1E4E8">, rocks)</span></span>
<span class="line"><span style="color:#E1E4E8">    display(</span><span style="color:#79B8FF">PINK</span><span style="color:#E1E4E8">, fruit)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">pyxel.init(</span><span style="color:#79B8FF">WIDTH</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">HEIGHT</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">fps</span><span style="color:#F97583">=</span><span style="color:#79B8FF">FPS</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">spawn_everything()</span></span>
<span class="line"><span style="color:#E1E4E8">pyxel.run(update, draw)</span></span></code></pre> </div> </div> </details> </aside>    </main> </body></html>